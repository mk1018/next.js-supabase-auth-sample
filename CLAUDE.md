<language>Japanese</language>
<character_code>UTF-8</character_code>

# next.js with supabase auth sample

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

## æ¦‚è¦

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«åŸºã¥ãã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ä¿å®ˆæ€§ã®é«˜ã„ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

### ğŸ—ï¸ åŸºç›¤æ©Ÿèƒ½

- **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: Supabaseèªè¨¼
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase PostgreSQL

### ğŸ¯ ã‚³ã‚¢æ©Ÿèƒ½

- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: ãƒ­ã‚°ã‚¤ãƒ³çµæœã®è¡¨ç¤ºç”»é¢

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: TypeScript
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase PostgreSQL
- **èªè¨¼**: Supabase

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
src/
â”œâ”€â”€ domain/              # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â””â”€â”€ repositories/    # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ app/                 # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”œâ”€â”€ api/             # API
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â””â”€â”€ (etc..)/
â”œâ”€â”€ infrastructure/      # ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±¤
â”‚   â”œâ”€â”€ database/        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ supabase/    # supabase server api
â”‚   â”‚   â””â”€â”€ etc../
â”‚   â”œâ”€â”€ external-apis/   # å¤–éƒ¨APIçµ±åˆ
â”‚   â”‚   â”œâ”€â”€ openai/
â”‚   â”‚   â””â”€â”€ etc../
â”‚   â””â”€â”€ repository/      # ãƒªãƒã‚¸ãƒˆãƒª
â”œâ”€â”€ backend/             # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ entity/          # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â””â”€â”€ use-case/        # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤
â”œâ”€â”€ components/          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ hooks/               # use(hooks)ã®å®šç¾©
â”œâ”€â”€ stores/              # ãƒ­ãƒ¼ã‚«ãƒ«store
â”œâ”€â”€ middleware.ts        # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”œâ”€â”€ types/               # å‹å®šç¾©
â”œâ”€â”€ errors/              # ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
â”œâ”€â”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ log/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â””â”€â”€ __test__/            # ãƒ†ã‚¹ãƒˆ
```

```
supabase/            # Supabase
â”œâ”€â”€ migrations/
â””â”€â”€ config.toml
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Node.js 20+
- Docker
- Supabase CLI

# å¿…é ˆè¦ä»¶

## Supabaseã®ã‚­ãƒ¼ã«ã¤ã„ã¦

NEXT_PUBLIC_SUPABASE_ANON_KEYï¼šèªè¨¼ã®ã¿ã«ä½¿ã†ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ¥ç¶šã«ã¯ä½¿ç”¨ã—ãªã„ã€‚
SUPABASE_SERVICE_ROLE_KEYï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ¥ç¶šã€å‚ç…§ã€è¿½åŠ ã€æ›´æ–°ã€å‰Šé™¤ã®ã¿ã«ä½¿ã†ã€‚

## APIã«ã¤ã„ã¦

- APIã¯use-caseã‚’å‘¼ã¶ãŸã‚ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã®ã¿ã‚’å®šç¾©ã™ã‚‹ã“ã¨
- APIã§Repositoryã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€constructorã§use-caseã«æ¸¡ã™ã“ã¨

```typescript
# ä¾‹:
usecase = UserUsecase(
    new UserRepository(db)
)
```

- usecaseã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ã“ã¨

## å‹è£œæ­£ã«ã¤ã„ã¦

`as`ã‚’ä½¿ã£ã¦ã®å‹è£œæ­£ã¯ç¦æ­¢ã§ã™ã€é©åˆ‡ãªå‹å®šç¾©ã¨type guardã‚’ä½¿ã†ã“ã¨ã€‚
`as any`ã¯ç¦æ­¢ã§ã™ã€‚
`unkown`ã‚‚ç¦æ­¢ã§ã™ã€‚ï¼ˆè¨­è¨ˆä¸Šå¿…é ˆã®å ´åˆã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ï¼‰

## Userã«ã¤ã„ã¦

- Userãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä½œæˆã—ãªã„ã“ã¨ã€‚
- Supabaseã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆAuthUserãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¤ã„ã¦

- migrationsãƒ•ã‚¡ã‚¤ãƒ«ã¯supabaseã®CLIã§ä½œæˆã™ã‚‹ã“ã¨

```bash
supabase migration new <ãƒ•ã‚¡ã‚¤ãƒ«å>
ä¾‹ï¼š
supabase migration new create_customers_table
```

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ¥ç¶šã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®SupabaseAdminã§è¡Œã†ã“ã¨
  @/infrastructure/database/supabase/admin.ts
- RLSã¯è¨­å®šã™ã‚‹å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚

## Supabaseèªè¨¼ã«ã¤ã„ã¦

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: @/infrastructure/database/supabase/client.ts
ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰: @/infrastructure/database/supabase/server.ts
Middleware: @/infrastructure/database/supabase/middleware.ts
ANONã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦

- use-caseã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ã“ã¨

## ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ãŸå ´åˆã¯å¿…ãšä»¥ä¸‹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨

å¿…ãšä¸€ã¤ãšã¤é€²ã‚ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰è§£æ±ºã—ã¦ã‹ã‚‰æ¬¡ã«é€²ã‚€ã“ã¨

1. npm run format
2. npm run lint:fix
3. npm run test
4. npm run build
   ä¸€ã¤ã§ã‚‚å¤±æ•—ã—ãŸå ´åˆã¯å¿…ãšã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨

## ãƒ­ã‚°ã«ã¤ã„ã¦

- console.logã¯å¿…ãšå‰Šé™¤ã™ã‚‹ã“ã¨ã€‚ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ãŠã‘ã‚‹console.error, console.warningã¯è¨±å¯ã™ã‚‹ï¼‰
- ãƒ‡ãƒãƒƒã‚°ç”¨ã«ä¸€æ™‚çš„ã«ä½œæˆã™ã‚‹ã“ã¨ã®ã¿è¨±å¯ã™ã‚‹ã€‚

## PRèª¬æ˜ä½œæˆ

`.github/PULL_REQUEST_TEMPLATE.md` ã«æ²¿ã£ã¦PRã«è¨˜è¼‰ã™ã‚‹å†…å®¹ã‚’ `.pr-template.md` ã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
